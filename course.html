<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <link rel="stylesheet" href="./css/learn.css">
    <!--Fontawesome-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--Font-->
    <link href="https://fonts.googleapis.com/css?family=Athiti" rel="stylesheet">
    <!--script-js-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <title>Course_detail</title>

</head>
<style>
    #D_navbar_footer,
        {
        position: absolute;
    }

    #A_navbar_top {
        top: 0;
        width: 100%;
        height: 50px;
    }

    #B_learn {
        top: 59px;
        width: 100%;
        bottom: 100px;
    }

    #D_navbar_footer {
        bottom: 0;
        width: 100%;
        height: 50px;
    }
    #accordion-container .accordion-item h3 {
    background: #efefef;
    padding: 5px;
    cursor: pointer;
    margin-bottom: 0;
}
#accordion-container .accordion-item h3:before {
    content: "+";
    display: inline-block;
    padding: 0 5px;
    width: 15px;
}
#accordion-container .accordion-item.active h3:before {
    content: "-";
}
#accordion-container .accordion-item .accordion-content {
    border: 1px solid #efefef;
    border-top: 0;
    padding: 10px;
}
#accordion-container .accordion-item .accordion-content p {
    padding: 0;
    margin: 0;
}
</style>

<body>
    <div id="container">
        <!--Navbar-->
        <div id="A_navbar_top">
            <div class="sticky-top" style="width: 100%">
                <nav class="navbar navbar-expand-md navbar-dark bg-dark" style="width: 100%">
                    <div class="col-md-8" style="margin-left: 3%;">
                        <a class="navbar-brand" href="#">
                            <img src="./picture/programming.png" alt="programming Language" class="logo">
                        </a>
                    </div>

                    <div class="col-md-4" style="margin-left: 0%;">
                        <div class="collapse navbar-collapse" id="navbarsmenu">
                            <ul class="navbar-nav ">
                                <li class="nav-item active">
                                    <a class="nav-link" href="./../../moodle/my/index.php">หน้าแรก
                                        <span class="sr-only">(current)</span>
                                    </a>
                                </li>
                                <li class="nav-item active">
                                    <a class="nav-link FullUserName" href="#">
                                        User
                                    </a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="https://example.com" id="menu"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-user-o" aria-hidden="true"></i>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="menu">
                                        <a class="dropdown-item" href="./../../moodle/index.php">วิชาเรียนทั้งหมด</a>

                                        <a class="dropdown-item" href="./../../moodle/user/profile.php">แก้ไขโปรไฟล์</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="./../../moodle/login/logout.php">ออกจากระบบ</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsmenu"
                        aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </nav>

            </div>
        </div>

        <!--Content-->
        <div id="B_learn">
            <div class="scrollbar" id="style-default">
                <div class="course_detail_box">
                    <div id="learn">
                        <div class="force-overflow">
                            <div id="accordion-container"></div>
                            <div id="cer-container"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!--footer-->
    <div id="D_navbar_footer">
        <div class="fixed-bottom">
            <nav class="navbar-footer" style="padding-top: 1%;">
                <div class="row">
                    <div class="col-lg-3 col-md-3">
                    </div>
                    <div class="col-lg-3 col-md-3">
                    </div>
                    <div class="col-lg-3 col-md-3">
                        <p class="title-widget">LEARNING PROGRAMMING</p>
                        <a class="dataCclickabout" style="color:blue;text-decoration: none;cursor: pointer;">
                            <i class="fa fa-angle-double-right"></i> เกี่ยวกับ </a>
                    </div>
                    <div class="col-lg-3 col-md-3 hidden-xs">
                        <p class="title-widget">ติดต่อ</p>
                        <div class="footerp">
                            <p>
                                <a>Email :</a>
                                <a href="#" style="text-decoration: none ;">code4thailand.pl@gmail.com</a>
                            </p>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    </div>



    <!--script-->
    <script>
        function ShowNowPage() {
            var NowP = parseInt($('#nowPage').get(0).innerHTML);

            var AllTopic = $('.topicText');
            var AllContent = $('.contentText');
            for (var i = 0; i < AllTopic.length; i++) {
                if ((NowP - 1) == i) {
                    $(AllTopic.get(i)).attr('style', '');
                    $(AllContent.get(i)).attr('style', '');
                    var val = $(AllTopic.get(i)).attr('val');
                    $('#examcode_teach div[class="Example' + val + '"]').attr('style', '');
                } else {
                    $(AllTopic.get(i)).attr('style', 'display:none;');
                    $(AllContent.get(i)).attr('style', 'display:none;');
                    var val = $(AllTopic.get(i)).attr('val');
                    $('#examcode_teach div[class="Example' + val + '"]').attr('style', 'display:none;');
                }
                PR.prettyPrint()

            }
        }

        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
        //get แสดงบทเรียน หัวข้อ
        $(function () {
            var UsId = getParameterByName('id');
            UsId = UsId == null ? 0 : UsId;
            $.ajax({
                type: 'get',
                url: 'https://localhost:44384/api/values/' + UsId,
                //url: 'http://35.240.168.120/api/api/values/' + UsId,
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    var j = data;
                    var jsonString = JSON.stringify(j)
                    JSON.stringify(jsonString);
                    // alert("Success" + jsonString);
                    //---------------------------------------Chapter-------------------------------
                    $('#accordion-container').innerHTML = '';
                    var resultsStr = '';
                    var all100Per = true;
                    for (var i = 0; i < j.length; i++) {
                        if (j[i].persent.toString() != '100') {
                            all100Per = false;
                        }
                        resultsStr += '<div class="accordion-item">' +
                            '<table style="width:100%;font-size:18px;cursor:pointer;">' +
                            '<tr><th colspan="2">' + '<h3>' + ' ' + "บทที่" + (i + 1) + " : " + j[i]
                            .chapter_name + '<span style="float: right;padding-right: 5px;">' + j[i]
                            .persent + '%</span></h3>' + '</th></tr>' + '</table>' +
                            '<div class="accordion-content">' +
                            "<table  " +
                            ' style="width:100%;font-size:18px;cursor:pointer;">';
                        for (var k = 0; k < j[i].topic.length; k++) {
                            resultsStr += '<tr class="dataCclick" val="' + j[i].chapter_id +
                                '" tpid="' + j[i].topic[k].topic_id +
                                '"><th style="padding-left:50px">' +
                                (k + 1) + '. ' + j[i].topic[k].topic_name + '</th>' +
                                '<th style="text-align:end;">' + j[i].topic[k].persent + '%</th>' +
                                '</tr>';

                        }
                        resultsStr += '<tr class="GotoGame" val="' + (i + 1) +
                            '"><th style="padding-left:50px">' +
                            (j[i].topic.length + 1) + '. เกม </th>' +
                            '<th style="text-align:end;"></th>' + '</tr>';

                        resultsStr += '</table>' + '</div>' + '</div>';
                    }
                    $('#cer-container').get(0).innerHTML = '';
                    if (all100Per == true) {
                        $('#cer-container').get(0).innerHTML = '<a>Download Cer</a>';
                    }
                    $('#accordion-container').html(resultsStr);
                    $(".GotoGame").click(function () {
                        var id = $(this).attr('val');
                        if (id == '1') {
                            window.location.href = 'http://35.240.168.120/game/';
                        } else {
                            window.location.href = 'http://35.240.168.120/game/';
                        }

                    });
                    $(".dataCclick").click(function () {
                        var UsId = getParameterByName('id');
                        UsId = UsId == null ? 0 : UsId;
                        var id = $(this).attr('val');
                        var tpid = $(this).attr('tpid');
                        window.location.href = '../php/test2.html?id=' + UsId + '&cp=' + id +
                            '&tp=' + tpid
                        $.ajax({
                            type: 'get',
                            url: 'https://localhost:44384/api/UpdateLogUser/' +
                                txt,
                            contentType: 'application/json; charset=utf-8',
                            success: function (data) {
                                if (data == 'Pass') {
                                    $('.pcr' + data).attr('style', '');
                                    $('.pc' + pcId).attr('style', '');
                                    $('.CanNextPage').get(0).innerHTML = data;
                                    var tpId = $('.NowTP').get(0).innerHTML;
                                    $('.tpid' + tpId).attr('val', data);
                                    $(AllTopic.get(NowP - 1)).attr('NowPt',
                                        data);
                                } else {
                                    $('.pcr' + data).attr('style', '');
                                    $('.pc' + pcId).attr('style', '');
                                    $('.Nowpractices').get(0).innerHTML = data;
                                    var tpId = $('.NowTP').get(0).innerHTML;
                                    $('.tpid' + tpId).attr('val', data);
                                    var NowP = parseInt($('#nowPage').get(0).innerHTML);
                                }
                            },
                            error: function (data) {

                            }
                        });
                    });

                    var $items = $('.accordion-item');
                    var x, y;
                    for (x = 0, y = j.length; x < y; x++) {
                        $items.eq(x).find('.accordion-content').slideUp(0);
                    }
                    $items.find('h3').click(function () {
                        var $thisAcc = $(this).closest('.accordion-item'),
                            $thisContents = $thisAcc.find('.accordion-content');

                        if ($thisAcc.hasClass('active')) {
                            $thisContents.stop().slideUp(150, function () {
                                $thisAcc.removeClass('active');
                            });
                        } else {
                            $thisContents.stop().slideDown(150, function () {
                                $thisAcc.addClass('active');
                            });
                        }
                    });
                },
                error: function (data) {
                    alert("Error to get json");
                }
            });
        });




        $(".dataCclickabout").click(function () {
            var UsId = getParameterByName('id');
            UsId = UsId == null ? 0 : UsId;
            var id = $(this).attr('val');
            window.location.href = '../php/about.html?id=' + UsId
        });

        //get user
        $(function () {
            var UsId = getParameterByName('id');
            UsId = UsId == null ? 0 : UsId;
            $.ajax({
                type: 'get',
                 url: 'https://localhost:44384/api/GetUserByID/' + UsId,
               // url: 'http://35.240.168.120/api/api/GetUserByID/' + UsId,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data == '') {
                        alert("ไม่พบผู้ใช้งาน");
                    } else {
                        $('.FullUserName').get(0).innerHTML = data;
                    }
                },
                error: function (data) {
                    alert("ไม่พบผู้ใช้งาน");
                }
            });
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

</body>


</html>
